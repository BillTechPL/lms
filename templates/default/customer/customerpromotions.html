<style>
    div.lms-ui-multiselect hr {
        margin-top: 0px;
        margin-bottom: 0px;
    }
</style>

<table id="a_promotions">
	<tr>
		<td>
			<img src="img/location.png" alt="">
		</td>
		<td class="bold">
			{trans("Location:")}
		</td>
		<td style="width: 98%;">
			<select name="{$variable_prefix}[location]" id="location-select" {tip text="Select promotion location"}>
				<OPTION value="">{trans("- all -")}</OPTION>
				{foreach $locations as $location}
				<OPTION value="{$location}"{if $variables.location == $location} selected{/if}>{$location}</OPTION>
				{/foreach}
			</select>
		</td>
	</tr>
	<TR>
		<TD>
			<IMG src="img/promoschema.gif" alt="">
		</TD>
		<TD class="bold">
			{trans("Schema")}:
		</TD>
		<TD style="width: 98%;">
			<SELECT size="1" name="{$variable_prefix}[schemaid]" id="promotion-select" {tip text="Select promotion schema"}>
				{foreach $promotions as $promotion}
					<optgroup label="{$promotion.name}" data-valid="{$promotion.valid}"{if !$promotion.valid} class="blend"{if !$variables.alltariffs} style="display: none;"{/if}{/if}>
						{foreach $promotion.schemas as $schemaid => $schema}
								<OPTION value="{$schemaid}"{if $variables.schemaid == $schemaid} SELECTED{/if} data-valid="{$promotion.valid}"{if !$promotion.valid} class="blend"{/if}>{$schema.name|truncate:40:"...":true}</OPTION>
						{/foreach}
					</optgroup>
				{/foreach}
			</SELECT>
		</TD>
	</TR>
	<TR>
		<TD></TD>
		<TD colspan="2">
			{foreach $promotions as $promotionid => $promotion}
				{foreach $promotion.schemas as $schemaid => $schema}
					<table class="promotion-table" id="schema{$schemaid}">
						{foreach $schema.items as $label => $item}
						<tr>
							<td class="valign-top text-right">
								{t a=$label}<!tariffselection>$a:{/t}
							</td>
							<td class="valign-top" style="padding-bottom: 10px; padding-top: 0;">
								<table>
									<tr>
										{if isset($item.single)}
										<td class="valign-top{if !$item.single.optional} blend{/if}">
											<label>
												<input class="schema-tariff-checkbox" type="checkbox" name="{$variable_prefix}[stariffid][{$schemaid}][{$label}]"
													value="{$item.single.tariffid}" data-label="{$label}"
													{if isset($variables.stariffid[$schemaid][$label]) || !$item.single.optional} checked{/if}
													{if !$item.single.optional} disabled data-mandatory="1"{/if} data-tariffaccess="{$item.single.authtype}">
												{$item.single.tariff}
											</label>
										</td>
										{else}
										<td class="valign-top">
											<select class="schema-tariff-selection" name="{$variable_prefix}[stariffid][{$schemaid}][{$label}]" data-label="{$label}">
												{if !$item.selection.required}
												<option value="0" data-tariffaccess="-1">{trans("- none -")}</option>
												{/if}
												{foreach $item.selection.items as $item}
												<option value="{$item.tariffid}" data-tariffaccess="{$item.authtype}"
													{if in_array($item.tariffid, $variables.stariffid[$schemaid])} selected{/if}>{$item.tariff}</option>
												{/foreach}
											</select>
										</td>
										{/if}
									</tr>
									<tr class="customernodes" data-schemaid="{$schemaid}" data-label="{$label}">
										{*
											content of this row is generated by ajax
											?m=customernodes&api=1&customerid=... call
										*}
									</tr>
								</table>
							</td>
						</tr>
						{/foreach}
					</table>
				{/foreach}
			{/foreach}
		</TD>
	</TR>
</table>
